/* Generated by CIL v. 1.3.6 */
/* print_CIL_Input is false */

struct MVReconstruct_variables {
   int BUF_SIZE ;
   int res_shift ;
   int bptr ;
   int aptr ;
   int mbwidth ;
   int mv_rsize ;
   int sum_x ;
   int sum_y ;
   int mag ;
   int cpred ;
   int mbx ;
   int comp ;
   int x_flag ;
   int mv_x ;
   int mv_y ;
   int fourmv ;
   int bpred ;
   int top_edge ;
   int mv_high ;
   int ptr ;
   int Y_SELECT ;
   int mv_range ;
   int cptr ;
   int mv_low ;
   int apred ;
   int buf[968] ;
   int pred_x ;
   int pred_y ;
};
void libcal_printf(char const   *format  , ...) ;
// To enable traces, change 1 by 0 in the #if below
#if 1
#define libcal_printf //
#endif
int currentSystemTime(void) ;
int openFile(char *file_name ) ;
void picture_displayImage(void) ;
void picture_setPixel(int x , int y , int r , int g , int b ) ;
int readByte(int fd ) ;
int JFrame(char *title ) ;
int Picture(int width , int height ) ;
void MVReconstruct_advance(struct MVReconstruct_variables *_actor_variables ) ;
int MVReconstruct_compute_dot_done(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_compute_dot_start(struct MVReconstruct_variables *_actor_variables ,
                                     int a ) ;
void MVReconstruct_do_pred(struct MVReconstruct_variables *_actor_variables ) ;
int MVReconstruct_function_middle(struct MVReconstruct_variables *_actor_variables ,
                                  int a , int b , int c ) ;
int MVReconstruct_function_mvcalc(struct MVReconstruct_variables *_actor_variables ,
                                  int pred , int mag , int mag_shift ) ;
int MVReconstruct_function_mvclip(struct MVReconstruct_variables *_actor_variables ,
                                  int v ) ;
int MVReconstruct_function_uvclip_1(struct MVReconstruct_variables *_actor_variables ,
                                    int v ) ;
int MVReconstruct_function_uvclip_4(struct MVReconstruct_variables *_actor_variables ,
                                    int v ) ;
void MVReconstruct_get_mag(struct MVReconstruct_variables *_actor_variables , int m ) ;
void MVReconstruct_get_pred(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_get_residual_dot_adjust(struct MVReconstruct_variables *_actor_variables ,
                                           int s ) ;
void MVReconstruct_get_residual_dot_calc(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_get_residual_dot_clip(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_get_residual_dot_final(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_get_residual_dot_init(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_get_residual_dot_shift(struct MVReconstruct_variables *_actor_variables ) ;
void MVReconstruct_geth(struct MVReconstruct_variables *_actor_variables , int h ) ;
void MVReconstruct_getw(struct MVReconstruct_variables *_actor_variables , int w ) ;
void MVReconstruct_read_dot_motion(struct MVReconstruct_variables *_actor_variables ,
                                   int cmd ) ;
void MVReconstruct_read_dot_noMotion(struct MVReconstruct_variables *_actor_variables ,
                                     int cmd ) ;
void MVReconstruct_start(struct MVReconstruct_variables *_actor_variables , int cmd ) ;
void MVReconstruct_write_dot_chroma(struct MVReconstruct_variables *_actor_variables ,
                                    int *MV ) ;
void MVReconstruct_write_dot_luma(struct MVReconstruct_variables *_actor_variables ,
                                  int *MV ) ;
void MVReconstruct_advance(struct MVReconstruct_variables *_actor_variables ) 
{ int _if_2 ;

  {
  (_actor_variables->comp) ++;
  if (_actor_variables->comp == 6) {
    _actor_variables->comp = 0;
    (_actor_variables->mbx) ++;
    if (_actor_variables->mbx == _actor_variables->mbwidth) {
      _actor_variables->top_edge = 0;
    }
    if (_actor_variables->ptr == 8) {
      _if_2 = _actor_variables->BUF_SIZE - 8;
    } else {
      _if_2 = _actor_variables->ptr - 8;
    }
    _actor_variables->ptr = _if_2;
  }
}
}
int MVReconstruct_compute_dot_done(struct MVReconstruct_variables *_actor_variables ) 
{ int res ;

  {

}
}
void MVReconstruct_compute_dot_start(struct MVReconstruct_variables *_actor_variables ,
                                     int a ) 
{ 

  {
  _actor_variables->aptr = _actor_variables->bptr;
  _actor_variables->bptr = _actor_variables->cptr;
  _actor_variables->cptr = a;
}
}
void MVReconstruct_do_pred(struct MVReconstruct_variables *_actor_variables ) 
{ int _call_2 ;

  {
  if (_actor_variables->comp >= 2 || ! _actor_variables->top_edge) {
    _call_2 = MVReconstruct_function_middle(_actor_variables, _actor_variables->apred,
                                            _actor_variables->bpred, _actor_variables->cpred);
    _actor_variables->apred = _call_2;
  }
}
}
int MVReconstruct_function_middle(struct MVReconstruct_variables *_actor_variables ,
                                  int a , int b , int c ) 
{ int res ;
  int _if_6 ;
  int _if_7 ;
  int _if_8 ;
  int _if_9 ;
  int _if_10 ;

  {
  if (a < b) {
    if (a > c) {
      _if_7 = a;
    } else {
      if (b < c) {
        _if_6 = b;
      } else {
        _if_6 = c;
      }
      _if_7 = _if_6;
    }
    _if_10 = _if_7;
  } else {
    if (b > c) {
      _if_9 = b;
    } else {
      if (a < c) {
        _if_8 = a;
      } else {
        _if_8 = c;
      }
      _if_9 = _if_8;
    }
    _if_10 = _if_9;
  }
  res = _if_10;
  return (res);
}
}
int MVReconstruct_function_mvcalc(struct MVReconstruct_variables *_actor_variables ,
                                  int pred , int mag , int mag_shift ) 
{ int res ;
  int _if_6 ;
  int _if_7 ;

  {
  if (_actor_variables->mv_rsize == 0 || mag == 0) {
    _if_7 = pred + mag;
  } else {
    if (mag < 0) {
      _if_6 = pred - mag_shift;
    } else {
      _if_6 = pred + mag_shift;
    }
    _if_7 = _if_6;
  }
  res = _if_7;
  return (res);
}
}
int MVReconstruct_function_mvclip(struct MVReconstruct_variables *_actor_variables ,
                                  int v ) 
{ int res ;
  int _if_4 ;
  int _if_5 ;

  {
  if (v < _actor_variables->mv_low) {
    _if_5 = v + _actor_variables->mv_range;
  } else {
    if (v > _actor_variables->mv_high) {
      _if_4 = v - _actor_variables->mv_range;
    } else {
      _if_4 = v;
    }
    _if_5 = _if_4;
  }
  res = _if_5;
  return (res);
}
}
int MVReconstruct_function_uvclip_1(struct MVReconstruct_variables *_actor_variables ,
                                    int v ) 
{ int vv ;
  int res ;
  int _if_5 ;

  {
  vv = v >> 1;
  if ((v & 3) == 0) {
    _if_5 = 0;
  } else {
    _if_5 = 1;
  }
  res = vv | _if_5;
  return (res);
}
}
int MVReconstruct_function_uvclip_4(struct MVReconstruct_variables *_actor_variables ,
                                    int v ) 
{ int sign ;
  int absv ;
  int resv ;
  int delta ;
  int vv ;
  int res ;
  int _if_9 ;
  int _if_10 ;
  int _if_11 ;
  int _if_12 ;

  {
  sign = v < 0;
  if (sign) {
    _if_9 = - v;
  } else {
    _if_9 = v;
  }
  absv = _if_9;
  resv = absv - ((absv >> 4) << 4);
  if (resv < 3) {
    _if_11 = 0;
  } else {
    if (resv > 13) {
      _if_10 = 2;
    } else {
      _if_10 = 1;
    }
    _if_11 = _if_10;
  }
  delta = _if_11;
  vv = ((absv >> 4) << 1) + delta;
  if (sign) {
    _if_12 = - vv;
  } else {
    _if_12 = vv;
  }
  res = _if_12;
  return (res);
}
}
void MVReconstruct_get_mag(struct MVReconstruct_variables *_actor_variables , int m ) 
{ 

  {
  _actor_variables->mag = m;
}
}
void MVReconstruct_get_pred(struct MVReconstruct_variables *_actor_variables ) 
{ int t ;

  {
  t = _actor_variables->aptr;
  _actor_variables->apred = _actor_variables->bpred;
  _actor_variables->bpred = _actor_variables->cpred;
  _actor_variables->cpred = _actor_variables->buf[t];
  _actor_variables->aptr = _actor_variables->bptr;
  _actor_variables->bptr = _actor_variables->cptr;
  _actor_variables->cptr = t | _actor_variables->Y_SELECT;
}
}
void MVReconstruct_get_residual_dot_adjust(struct MVReconstruct_variables *_actor_variables ,
                                           int s ) 
{ 

  {
  _actor_variables->res_shift = (_actor_variables->res_shift + s) + 1;
}
}
void MVReconstruct_get_residual_dot_calc(struct MVReconstruct_variables *_actor_variables ) 
{ int _call_2 ;

  {
  _call_2 = MVReconstruct_function_mvcalc(_actor_variables, _actor_variables->apred,
                                          _actor_variables->mag, _actor_variables->res_shift);
  _actor_variables->res_shift = _call_2;
}
}
void MVReconstruct_get_residual_dot_clip(struct MVReconstruct_variables *_actor_variables ) 
{ int _call_2 ;

  {
  _call_2 = MVReconstruct_function_mvclip(_actor_variables, _actor_variables->res_shift);
  _actor_variables->res_shift = _call_2;
}
}
void MVReconstruct_get_residual_dot_final(struct MVReconstruct_variables *_actor_variables ) 
{ int sum ;

  {
  sum = _actor_variables->sum_x + _actor_variables->res_shift;
  _actor_variables->mv_x = _actor_variables->mv_y;
  _actor_variables->mv_y = _actor_variables->res_shift;
  _actor_variables->sum_x = _actor_variables->sum_y;
  _actor_variables->sum_y = sum;
  _actor_variables->x_flag = 1;
}
}
void MVReconstruct_get_residual_dot_init(struct MVReconstruct_variables *_actor_variables ) 
{ int _if_2 ;

  {
  if (_actor_variables->mag < 0) {
    _if_2 = ~ _actor_variables->mag;
  } else {
    _if_2 = _actor_variables->mag - 1;
  }
  _actor_variables->res_shift = _if_2;
}
}
void MVReconstruct_get_residual_dot_shift(struct MVReconstruct_variables *_actor_variables ) 
{ int count ;

  {
  count = _actor_variables->mv_rsize;
  while (count > 0) {
    _actor_variables->res_shift <<= 1;
    count --;
  }
}
}
void MVReconstruct_geth(struct MVReconstruct_variables *_actor_variables , int h ) 
{ 

  {

}
}
void MVReconstruct_getw(struct MVReconstruct_variables *_actor_variables , int w ) 
{ 

  {
  _actor_variables->mbwidth = w;
  _actor_variables->ptr = 8;
}
}
void MVReconstruct_read_dot_motion(struct MVReconstruct_variables *_actor_variables ,
                                   int cmd ) 
{ 

  {
  if (_actor_variables->comp == 0) {
    _actor_variables->fourmv = (cmd & 4) != 0;
    _actor_variables->sum_x = 0;
    _actor_variables->sum_y = 0;
  }
}
}
void MVReconstruct_read_dot_noMotion(struct MVReconstruct_variables *_actor_variables ,
                                     int cmd ) 
{ int p ;

  {
  p = _actor_variables->ptr | _actor_variables->comp;
  if (_actor_variables->comp < 4) {
    _actor_variables->buf[p] = 0;
    _actor_variables->buf[p | _actor_variables->Y_SELECT] = 0;
  }
}
}
void MVReconstruct_start(struct MVReconstruct_variables *_actor_variables , int cmd ) 
{ int fcode ;

  {
  fcode = (cmd & 448) >> 6;
  _actor_variables->mbx = 0;
  _actor_variables->top_edge = 1;
  _actor_variables->comp = 0;
  if (fcode > 0) {
    _actor_variables->mv_rsize = fcode - 1;
    _actor_variables->mv_range = 1 << (_actor_variables->mv_rsize + 5);
    _actor_variables->mv_low = - _actor_variables->mv_range;
    _actor_variables->mv_high = _actor_variables->mv_range - 1;
    _actor_variables->mv_range <<= 1;
  }
}
}
void MVReconstruct_write_dot_chroma(struct MVReconstruct_variables *_actor_variables ,
                                    int *MV ) 
{ int mv ;
  int t ;
  int _call_5 ;
  int _call_6 ;
  int _if_7 ;

  {
  if (_actor_variables->fourmv) {
    _call_5 = MVReconstruct_function_uvclip_4(_actor_variables, _actor_variables->sum_x);
    _if_7 = _call_5;
  } else {
    _call_6 = MVReconstruct_function_uvclip_1(_actor_variables, _actor_variables->sum_x);
    _if_7 = _call_6;
  }
  mv = _if_7;
  t = _actor_variables->sum_x;
  _actor_variables->sum_x = _actor_variables->sum_y;
  _actor_variables->sum_y = t;
  *MV = mv;
}
}
void MVReconstruct_write_dot_luma(struct MVReconstruct_variables *_actor_variables ,
                                  int *MV ) 
{ int p ;
  int t ;
  int _if_5 ;

  {
  p = _actor_variables->ptr | _actor_variables->comp;
  t = _actor_variables->mv_x;
  if (_actor_variables->x_flag) {
    _if_5 = 0;
  } else {
    _if_5 = _actor_variables->Y_SELECT;
  }
  _actor_variables->buf[p | _if_5] = _actor_variables->mv_x;
  _actor_variables->mv_x = _actor_variables->mv_y;
  _actor_variables->mv_y = t;
  _actor_variables->x_flag = ! _actor_variables->x_flag;
  *MV = t;
}
}

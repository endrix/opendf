# elaborate.mk - elaborate a CAL network/model (create instances of
#                subnetworks and actors).
#                Assumed to be used in sub-make from main Makefile

ifeq "$(strip $(MODEL))" ""
  $(error MODEL not set)
endif

# delete the built-in suffixes to avoid surprises
.SUFFIXES:   

# include $(MODEL).depend (regenerate from .xdf if it doesn't exist)
# it declares the dependence of .xdf on network (.nl) files
include $(MODEL).depend

#
# all: sets up .xdf, *.calml and config.c
#

.PHONY: all
all: $(MODEL).depend config.c

#
# Dependence of .xlim on .par and .cal (generated from .xdf)
#
$(MODEL).depend: $(MODEL).xdf
	@$(SAXON8) -o $@ $< $(XDF2DEPEND_XSL)

#
# Generate network configuration from .xdf
#
config.c: $(MODEL).xdf
	@$(SAXON8) -o $@ $< $(GENERATECONFIG_XSL)

#
# Dependence of $(MODEL).xdf on network (.nl) files is
# declared in $(MODEL).depend. 
#
$(MODEL).xdf:
	@$(ELABORATOR) -mp $(srcdir) $(MODEL)
	@$(XDF2PAR) $(MODEL).xdf
